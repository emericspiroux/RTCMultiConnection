'use strict';function asyncGeneratorStep(e,t,n,s,i,r,o){try{var a=e[r](o),d=a.value}catch(e){return void n(e)}a.done?t(d):Promise.resolve(d).then(s,i)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(s,i){function r(e){asyncGeneratorStep(a,s,i,r,o,"next",e)}function o(e){asyncGeneratorStep(a,s,i,r,o,"throw",e)}var a=e.apply(t,n);r(void 0)})}}function _typeof(e){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}var RTCMultiConnection=function(e,t){function n(t,n){function s(e){return!e.audio&&!e.video&&!e.screen&&e.data}function i(e,n){t.peersBackup[e]||(t.peersBackup[e]={userid:e,extra:{}}),t.peersBackup[e].extra=n}function r(e){if(e.remoteUserId==t.userid){if(t.peers[e.sender]&&t.peers[e.sender].extra!=e.message.extra&&(t.peers[e.sender].extra=e.extra,t.onExtraDataUpdated({userid:e.sender,extra:e.extra}),i(e.sender,e.extra)),e.message.streamSyncNeeded&&t.peers[e.sender]){var n=t.streamEvents[e.message.streamid];if(!n||!n.stream)return;var o=e.message.action;if("ended"===o||"inactive"===o||"stream-removed"===o)return t.peersBackup[n.userid]&&(n.extra=t.peersBackup[n.userid].extra),void t.onstreamended(n);var d="both"==e.message.type?null:e.message.type;return void("function"==typeof n.stream[o]&&n.stream[o](d))}if("dropPeerConnection"===e.message)return void t.deletePeer(e.sender);if(e.message.allParticipants)return-1===e.message.allParticipants.indexOf(e.sender)&&e.message.allParticipants.push(e.sender),void e.message.allParticipants.forEach(function(e){a[t.peers[e]?"renegotiatePeer":"createNewPeer"](e,{localPeerSdpConstraints:{OfferToReceiveAudio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:t.session.oneway?!!t.session.audio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.session.oneway?!!t.session.video||!!t.session.screen:t.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!t.session.oneway||"one-way"===t.direction,isDataOnly:s(t.session)})});if(e.message.newParticipant)return e.message.newParticipant==t.userid?void 0:t.peers[e.message.newParticipant]?void 0:void a.createNewPeer(e.message.newParticipant,e.message.userPreferences||{localPeerSdpConstraints:{OfferToReceiveAudio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:t.session.oneway?!!t.session.audio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.session.oneway?!!t.session.video||!!t.session.screen:t.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!t.session.oneway||"one-way"===t.direction,isDataOnly:s(t.session)});if(e.message.readyForOffer&&(t.attachStreams.length&&(t.waitingForLocalMedia=!1),t.waitingForLocalMedia))return void setTimeout(function(){r(e)},1);if(e.message.newParticipationRequest&&e.sender!==t.userid){t.peers[e.sender]&&t.deletePeer(e.sender);var c={extra:e.extra||{},localPeerSdpConstraints:e.message.remotePeerSdpConstraints||{OfferToReceiveAudio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:e.message.localPeerSdpConstraints||{OfferToReceiveAudio:t.session.oneway?!!t.session.audio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.session.oneway?!!t.session.video||!!t.session.screen:t.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:"undefined"==typeof e.message.isOneWay?!!t.session.oneway||"one-way"===t.direction:e.message.isOneWay,isDataOnly:"undefined"==typeof e.message.isDataOnly?s(t.session):e.message.isDataOnly,dontGetRemoteStream:"undefined"==typeof e.message.isOneWay?!!t.session.oneway||"one-way"===t.direction:e.message.isOneWay,dontAttachLocalStream:!!e.message.dontGetRemoteStream,connectionDescription:e,successCallback:function(){}};return void t.onNewParticipant(e.sender,c)}return e.message.changedUUID&&t.peers[e.message.oldUUID]&&(t.peers[e.message.newUUID]=t.peers[e.message.oldUUID],delete t.peers[e.message.oldUUID]),e.message.userLeft?(a.onUserLeft(e.sender),void(!e.message.autoCloseEntireSession||t.leave())):void a.addNegotiatedMessage(e.message,e.sender)}}var o="";o+="?userid="+t.userid,o+="&sessionid="+t.sessionid,o+="&msgEvent="+t.socketMessageEvent,o+="&socketCustomEvent="+t.socketCustomEvent,o+="&autoCloseEntireSession="+!!t.autoCloseEntireSession,!0===t.session.broadcast&&(o+="&oneToMany=true"),o+="&maxParticipantsAllowed="+t.maxParticipantsAllowed,t.enableScalableBroadcast&&(o+="&enableScalableBroadcast=true",o+="&maxRelayLimitPerUser="+(t.maxRelayLimitPerUser||2)),o+="&extra="+JSON.stringify(t.extra||{}),t.socketCustomParameters&&(o+=t.socketCustomParameters);try{io.sockets={}}catch(t){}if(t.socketURL||(t.socketURL="/"),"/"!=t.socketURL.substr(t.socketURL.length-1,1))throw"\"socketURL\" MUST end with a slash.";t.enableLogs&&("/"==t.socketURL?console.info("socket.io url is: ",location.origin+"/"):console.info("socket.io url is: ",t.socketURL));try{t.socket=io(t.socketURL+o)}catch(n){t.socket=io.connect(t.socketURL+o,t.socketOptions)}var a=t.multiPeersHandler;t.socket.on("extra-data-updated",function(e,n){t.peers[e]&&(t.peers[e].extra=n,t.onExtraDataUpdated({userid:e,extra:n}),i(e,n))}),t.socket.on(t.socketMessageEvent,r);var d=!1;t.socket.resetProps=function(){d=!1},t.socket.on("connect",function(){d||(d=!0,t.enableLogs&&console.info("socket.io connection is opened."),setTimeout(function(){t.socket.emit("extra-data-updated",t.extra)},1e3),n&&n(t.socket))}),t.socket.on("disconnect",function(e){t.onSocketDisconnect(e)}),t.socket.on("error",function(e){t.onSocketError(e)}),t.socket.on("user-disconnected",function(e){e===t.userid||(t.onUserStatusChanged({userid:e,status:"offline",extra:t.peers[e]?t.peers[e].extra||{}:{}}),t.deletePeer(e))}),t.socket.on("user-connected",function(e){e===t.userid||t.onUserStatusChanged({userid:e,status:"online",extra:t.peers[e]?t.peers[e].extra||{}:{}})}),t.socket.on("closed-entire-session",function(e,n){t.leave(),t.onEntireSessionClosed({sessionid:e,userid:e,extra:n})}),t.socket.on("userid-already-taken",function(e,n){t.onUserIdAlreadyTaken(e,n)}),t.socket.on("logs",function(e){t.enableLogs&&console.debug("server-logs",e)}),t.socket.on("number-of-broadcast-viewers-updated",function(e){t.onNumberOfBroadcastViewersUpdated(e)}),t.socket.on("set-isInitiator-true",function(e){e!=t.sessionid||(t.isInitiator=!0)})}function s(e){function t(){e.fbr=new FileBufferReader,e.fbr.onProgress=function(t){e.onFileProgress(t)},e.fbr.onBegin=function(t){e.onFileStart(t)},e.fbr.onEnd=function(t){e.onFileEnd(t)}}var n=this,s=["getAllParticipants","getLength","selectFirst","streams","send","forEach"];e.peers={getLength:function(){var e=0;for(var t in this)-1==s.indexOf(t)&&e++;return e},selectFirst:function(){var e;for(var t in this)-1==s.indexOf(t)&&(e=this[t]);return e},getAllParticipants:function(e){var t=[];for(var n in this)-1==s.indexOf(n)&&n!=e&&t.push(n);return t},forEach:function(t){this.getAllParticipants().forEach(function(n){t(e.peers[n])})},send:function(t,s){var i=this;if(!p(t.size)&&!p(t.type)){if(e.enableFileSharing)return void n.shareFile(t,s);"string"!=typeof t&&(t=JSON.stringify(t))}if("text"!==t.type&&!(t instanceof ArrayBuffer)&&!(t instanceof DataView))return void A.send({text:t,channel:this,connection:e,remoteUserId:s});if("text"===t.type&&(t=JSON.stringify(t)),s){var r=e.peers[s];if(r)return r.channels.length?void r.channels.forEach(function(e){e.send(t)}):(e.peers[s].createDataChannel(),e.renegotiate(s),void setTimeout(function(){i.send(t,s)},3e3))}this.getAllParticipants().forEach(function(n){return i[n].channels.length?void i[n].channels.forEach(function(e){e.send(t)}):(e.peers[n].createDataChannel(),e.renegotiate(n),void setTimeout(function(){i[n].channels.forEach(function(e){e.send(t)})},3e3))})}},this.uuid=e.userid,this.getLocalConfig=function(s,i,r){return r||(r={}),{streamsToShare:r.streamsToShare||{},rtcMultiConnection:e,connectionDescription:r.connectionDescription,userid:i,localPeerSdpConstraints:r.localPeerSdpConstraints,remotePeerSdpConstraints:r.remotePeerSdpConstraints,dontGetRemoteStream:!!r.dontGetRemoteStream,dontAttachLocalStream:!!r.dontAttachLocalStream,renegotiatingPeer:!!r.renegotiatingPeer,peerRef:r.peerRef,channels:r.channels||[],onLocalSdp:function(e){n.onNegotiationNeeded(e,i)},onLocalCandidate:function(t){t=M.processCandidates(e,t),t&&n.onNegotiationNeeded(t,i)},remoteSdp:s,onDataChannelMessage:function(s){if(!e.fbr&&e.enableFileSharing&&t(),"string"==typeof s||!e.enableFileSharing)return void n.onDataChannelMessage(s,i);var r=this;return s instanceof ArrayBuffer||s instanceof DataView?void e.fbr.convertToObject(s,function(e){r.onDataChannelMessage(e)}):s.readyForNextChunk?void e.fbr.getNextChunk(s,function(t){e.peers[i].channels.forEach(function(e){e.send(t)})},i):s.chunkMissing?void e.fbr.chunkMissing(s):void e.fbr.addChunk(s,function(t){e.peers[i].peer.channel.send(t)})},onDataChannelError:function(e){n.onDataChannelError(e,i)},onDataChannelOpened:function(e){n.onDataChannelOpened(e,i)},onDataChannelClosed:function(e){n.onDataChannelClosed(e,i)},onRemoteStream:function(t){e.peers[i]&&e.peers[i].streams.push(t),n.onGettingRemoteMedia(t,i)},onRemoteStreamRemoved:function(e){n.onRemovingRemoteMedia(e,i)},onPeerStateChanged:function(e){n.onPeerStateChanged(e),"new"===e.iceConnectionState&&n.onNegotiationStarted(i,e),"connected"===e.iceConnectionState&&n.onNegotiationCompleted(i,e),-1!==e.iceConnectionState.search(/closed|failed/gi)&&(n.onUserLeft(i),n.disconnectWith(i))}}},this.createNewPeer=function(t,n){if(!(e.maxParticipantsAllowed<=e.getAllParticipants().length)){if(n=n||{},!e.isInitiator||!e.session.audio||"two-way"!==e.session.audio||n.streamsToShare||(n.isOneWay=!1,n.isDataOnly=!1,n.session=e.session),!n.isOneWay&&!n.isDataOnly)return n.isOneWay=!0,void this.onNegotiationNeeded({enableMedia:!0,userPreferences:n},t);n=e.setUserPreferences(n,t);var s=this.getLocalConfig(null,t,n);e.peers[t]=new b(s)}},this.createAnsweringPeer=function(t,n,s){s=e.setUserPreferences(s||{},n);var i=this.getLocalConfig(t,n,s);e.peers[n]=new b(i)},this.renegotiatePeer=function(t,n,s){if(!e.peers[t])return void(e.enableLogs&&console.error("Peer ("+t+") does not exist. Renegotiation skipped."));n||(n={}),n.renegotiatingPeer=!0,n.peerRef=e.peers[t].peer,n.channels=e.peers[t].channels;var i=this.getLocalConfig(s,t,n);e.peers[t]=new b(i)},this.replaceTrack=function(t,n,s){if(!e.peers[n])throw"This peer ("+n+") does not exist.";var i=e.peers[n].peer;return!!i.getSenders&&"function"==typeof i.getSenders&&i.getSenders().length?void i.getSenders().forEach(function(i){s&&"video"===i.track.kind&&(e.peers[n].peer.lastVideoTrack=i.track,i.replaceTrack(t)),s||"audio"!==i.track.kind||(e.peers[n].peer.lastAudioTrack=i.track,i.replaceTrack(t))}):void(console.warn("RTPSender.replaceTrack is NOT supported."),this.renegotiatePeer(n))},this.onNegotiationNeeded=function(){},this.addNegotiatedMessage=function(t,s){if(t.type&&t.sdp)return"answer"==t.type&&e.peers[s]&&e.peers[s].addRemoteSdp(t),"offer"==t.type&&(t.renegotiatingPeer?this.renegotiatePeer(s,null,t):this.createAnsweringPeer(t,s)),void(e.enableLogs&&console.log("Remote peer's sdp:",t.sdp));if(t.candidate)return e.peers[s]&&e.peers[s].addRemoteCandidate(t),void(e.enableLogs&&console.log("Remote peer's candidate pairs:",t.candidate));if(t.enableMedia){e.session=t.userPreferences.session||e.session,e.session.oneway&&e.attachStreams.length&&(e.attachStreams=[]),t.userPreferences.isDataOnly&&e.attachStreams.length&&(e.attachStreams.length=[]);var i={};e.attachStreams.forEach(function(e){i[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),t.userPreferences.streamsToShare=i,n.onNegotiationNeeded({readyForOffer:!0,userPreferences:t.userPreferences},s)}t.readyForOffer&&e.onReadyForOffer(s,t.userPreferences)},this.onGettingRemoteMedia=function(){},this.onRemovingRemoteMedia=function(){},this.onGettingLocalMedia=function(){},this.onLocalMediaError=function(t,n){e.onMediaError(t,n)},this.shareFile=function(n,s){t(),e.fbr.readAsArrayBuffer(n,function(t){var n=e.getAllParticipants();s&&(n=[s]),n.forEach(function(n){e.fbr.getNextChunk(t,function(t){e.peers[n].channels.forEach(function(e){e.send(t)})},n)})},{userid:e.userid,chunkSize:"Firefox"===DetectRTC.browser.name?15000:e.chunkSize||0})};new w(e);this.onDataChannelMessage=function(t,n){(void 0).receive(JSON.parse(t),n,e.peers[n]?e.peers[n].extra:{})},this.onDataChannelClosed=function(t,n){t.userid=n,t.extra=e.peers[n]?e.peers[n].extra:{},e.onclose(t)},this.onDataChannelError=function(t,n){t.userid=n,event.extra=e.peers[n]?e.peers[n].extra:{},e.onerror(t)},this.onDataChannelOpened=function(t,n){return e.peers[n].channels.length?void(e.peers[n].channels=[t]):void(e.peers[n].channels.push(t),e.onopen({userid:n,extra:e.peers[n]?e.peers[n].extra:{},channel:t}))},this.onPeerStateChanged=function(t){e.onPeerStateChanged(t)},this.onNegotiationStarted=function(){},this.onNegotiationCompleted=function(){},this.getRemoteStreams=function(t){return t=t||e.peers.getAllParticipants()[0],e.peers[t]?e.peers[t].streams:[]}}function i(e,t,n){if("undefined"!=typeof CustomEvent){var s=new CustomEvent(t,{arguments:n,__exposedProps__:n});e.dispatchEvent(s)}}function r(e,t){if(t.stream&&g(t.stream,"audio").length){if(!e||!t)throw"Both arguments are required.";if("undefined"==typeof hark)throw"hark.js not found.";var n=new hark(t.stream,{interval:100});n.on("speaking",function(){e.onspeaking&&e.onspeaking(t)}),n.on("stopped_speaking",function(){e.onsilence&&e.onsilence(t)}),n.on("volume_change",function(n,s){e.onvolumechange&&e.onvolumechange({volume:n,threshold:s},t)})}}function o(e,t){t.stream&&t.stream&&t.stream.addEventListener&&(t.stream.addEventListener("mute",function(n){n=e.streamEvents[t.streamid],n.session={audio:"audio"===n.muteType,video:"video"===n.muteType},e.onmute(n)},!1),t.stream.addEventListener("unmute",function(n){n=e.streamEvents[t.streamid],n.session={audio:"audio"===n.unmuteType,video:"video"===n.unmuteType},e.onunmute(n)},!1))}function a(){if(window.crypto&&window.crypto.getRandomValues&&-1===navigator.userAgent.indexOf("Safari")){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),t="",n=0,s=e.length;n<s;n++)t+=e[n].toString(36);return t}return(Math.random()*new Date().getTime()).toString(36).replace(/\./g,"")}function d(e,t,n){if(!n.autoCreateMediaElement)return void t({});var s=!1;g(e,"video").length||e.isVideo||e.isScreen||(s=!0),"Firefox"===DetectRTC.browser.name&&(n.session.video||n.session.screen)&&(s=!1);var i=document.createElement(s?"audio":"video");if(i.srcObject=e,i.setAttribute("autoplay",!0),i.setAttribute("playsinline",!0),i.setAttribute("controls",!0),i.setAttribute("muted",!1),i.setAttribute("volume",1),"Firefox"===DetectRTC.browser.name){var r="ended";"oninactive"in i&&(r="inactive"),i.addEventListener(r,function(){if(currentUserMediaRequest.remove(e.idInstance),"local"===e.type){r="ended","oninactive"in e&&(r="inactive"),L.onSyncNeeded(e.streamid,r),n.attachStreams.forEach(function(t,s){e.streamid===t.streamid&&delete n.attachStreams[s]});var t=[];n.attachStreams.forEach(function(e){e&&t.push(e)}),n.attachStreams=t;var s=n.streamEvents[e.streamid];if(s)return void n.onstreamended(s);this.parentNode&&this.parentNode.removeChild(this)}},!1)}var o=i.play();if("undefined"!=typeof o){var a=!1;setTimeout(function(){a||(a=!0,t(i))},1e3),o.then(function(){a||(a=!0,t(i))})["catch"](function(){a||(a=!0,t(i))})}else t(i)}function c(e,t){window.removeEventListener(e,t),window.addEventListener(e,t,!1)}function m(e){var t=[];return e.forEach(function(e){e&&t.push(e)}),t}function u(e){return!e.audio&&!e.video&&!e.screen&&e.data}function p(e){return"undefined"==typeof e}function l(e){return"string"==typeof e}function f(e,t){return!(e.session.audio&&"two-way"===e.session.audio)&&(!("Firefox"!==DetectRTC.browser.name||!1===t)||!("Chrome"!==DetectRTC.browser.name||50>DetectRTC.browser.version)&&(!(!0!==typeof t)||!!("undefined"==typeof t&&e.session.audio&&e.session.screen&&!e.session.video)&&(t=!0,!0)))}function g(e,n){return e&&e.getTracks?e.getTracks().filter(function(e){return e.kind===(n||"audio")}):[]}function v(){var t=!1;try{if("undefined"==typeof RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var n=new E;try{n.addTransceiver("audio"),t=!0}catch(t){}n.close()}catch(n){t=!1}return t&&h()}function h(){var t=!1;try{var n=new E({sdpSemantics:"unified-plan"});try{var e=n.getConfiguration();t=!("unified-plan"!=e.sdpSemantics)||"plan-b"!=e.sdpSemantics&&!1}catch(n){t=!1}}catch(n){t=!1}return t}function S(){if("undefined"!=typeof cordova&&"undefined"!=typeof cordova.plugins&&"undefined"!=typeof cordova.plugins.iosrtc){var e=cordova.plugins.iosrtc;window.webkitRTCPeerConnection=e.RTCPeerConnection,window.RTCSessionDescription=e.RTCSessionDescription,window.RTCIceCandidate=e.RTCIceCandidate,window.MediaStream=e.MediaStream,window.MediaStreamTrack=e.MediaStreamTrack,navigator.getUserMedia=navigator.webkitGetUserMedia=e.getUserMedia,e.debug.enable("iosrtc*"),"function"==typeof e.selectAudioOutput&&e.selectAudioOutput(window.iOSDefaultAudioOutputDevice||"speaker"),e.registerGlobals()}}function C(e){var t={OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo};return t}function b(e){function t(t){t.binaryType="arraybuffer",t.onmessage=function(t){e.onDataChannelMessage(t.data)},t.onopen=function(){e.onDataChannelOpened(t)},t.onerror=function(t){e.onDataChannelError(t)},t.onclose=function(t){e.onDataChannelClosed(t)},t.internalSend=t.send,t.send=function(e){"open"!==t.readyState||t.internalSend(e)},o.channel=t}function n(t){o[t](T.sdpConstraints).then(function(t){"Safari"!==DetectRTC.browser.name&&(t.sdp=s.processSdp(t.sdp)),o.setLocalDescription(t).then(function(){s.trickleIce&&(e.onLocalSdp({type:t.type,sdp:t.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:i.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:s?s.extra:{},streamsToShare:f}),s.onSettingLocalDescription(i))},function(e){s.enableLogs&&console.error("setLocalDescription error",e)})},function(e){!s.enableLogs||console.error("sdp-error",e)})}if("undefined"==typeof window.RTCPeerConnection?"undefined"==typeof mozRTCPeerConnection?"undefined"!=typeof webkitRTCPeerConnection&&(E=webkitRTCPeerConnection):E=mozRTCPeerConnection:E=window.RTCPeerConnection,R=window.RTCSessionDescription||window.mozRTCSessionDescription,P=window.RTCIceCandidate||window.mozRTCIceCandidate,O=window.MediaStreamTrack,!E)throw"WebRTC 1.0 (RTCPeerConnection) API are NOT available in this browser.";var s=e.rtcMultiConnection;this.extra=e.remoteSdp&&e.remoteSdp.extra,this.userid=e.userid,this.streams=[],this.channels=e.channels||[],this.connectionDescription=e.connectionDescription,this.addStream=function(e){s.addStream(e,i.userid)},this.removeStream=function(e){s.removeStream(e,i.userid)};var i=this;e.remoteSdp&&(this.connectionDescription=e.remoteSdp.connectionDescription);var r={};T.sdpConstraints=C({OfferToReceiveAudio:!0,OfferToReceiveVideo:!0});var o,a=!!e.renegotiatingPeer;e.remoteSdp&&(a=!!e.remoteSdp.renegotiatingPeer);var d=[];if(s.attachStreams.forEach(function(e){!e||d.push(e)}),!a){var c="all";!s.candidates.turn&&!s.candidates.relay||s.candidates.stun||s.candidates.reflexive||s.candidates.host||(c="relay");try{var m={iceServers:s.iceServers,iceTransportPolicy:s.iceTransportPolicy||c};"undefined"!=typeof s.iceCandidatePoolSize&&(m.iceCandidatePoolSize=s.iceCandidatePoolSize),"undefined"!=typeof s.bundlePolicy&&(m.bundlePolicy=s.bundlePolicy),"undefined"!=typeof s.rtcpMuxPolicy&&(m.rtcpMuxPolicy=s.rtcpMuxPolicy),!s.sdpSemantics||(m.sdpSemantics=s.sdpSemantics||"unified-plan"),s.iceServers&&s.iceServers.length||(m=null,s.optionalArgument=null),o=new E(m,s.optionalArgument)}catch(t){try{var m={iceServers:s.iceServers};o=new E(m)}catch(t){o=new E}}}else o=e.peerRef;!o.getRemoteStreams&&o.getReceivers&&(o.getRemoteStreams=function(){var e=new x;return o.getReceivers().forEach(function(t){e.addTrack(t.track)}),[e]}),!o.getLocalStreams&&o.getSenders&&(o.getLocalStreams=function(){var e=new x;return o.getSenders().forEach(function(t){e.addTrack(t.track)}),[e]}),o.onicecandidate=function(t){if(!t.candidate){if(!s.trickleIce){var n=o.localDescription;e.onLocalSdp({type:n.type,sdp:n.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:i.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:s?s.extra:{},streamsToShare:f})}return}s.trickleIce&&e.onLocalCandidate({candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex})},d.forEach(function(t){e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.dontGetRemoteStream||e.dontAttachLocalStream||(t=s.beforeAddingStream(t,i),t&&(o.getLocalStreams().forEach(function(e){t&&e.id==t.id&&(t=null)}),t&&t.getTracks&&t.getTracks().forEach(function(e){try{o.addTrack(e,t)}catch(t){}})))}),o.oniceconnectionstatechange=o.onsignalingstatechange=function(){var t=i.extra;s.peers[i.userid]&&(t=s.peers[i.userid].extra||t),o&&(e.onPeerStateChanged({iceConnectionState:o.iceConnectionState,iceGatheringState:o.iceGatheringState,signalingState:o.signalingState,extra:t,userid:i.userid}),o&&o.iceConnectionState&&-1!==o.iceConnectionState.search(/closed|failed/gi)&&i.streams instanceof Array&&i.streams.forEach(function(e){var t=s.streamEvents[e.id]||{streamid:e.id,stream:e,type:"remote"};s.onstreamended(t)}))};var u={OfferToReceiveAudio:!!d.length,OfferToReceiveVideo:!!d.length};e.localPeerSdpConstraints&&(u=e.localPeerSdpConstraints),T.sdpConstraints=C(u);var p={};o.ontrack=function(t){if(t&&"track"===t.type){if(t.stream=t.streams[t.streams.length-1],t.stream.id||(t.stream.id=t.track.id),p[t.stream.id]&&"Safari"!==DetectRTC.browser.name)return void(t.track&&(t.track.onended=function(){o&&o.onremovestream(t)}));p[t.stream.id]=t.stream.id;var n={};e.remoteSdp&&e.remoteSdp.streamsToShare?n=e.remoteSdp.streamsToShare:e.streamsToShare&&(n=e.streamsToShare);var s=n[t.stream.id];s?(t.stream.isAudio=s.isAudio,t.stream.isVideo=s.isVideo,t.stream.isScreen=s.isScreen):(t.stream.isVideo=!!g(t.stream,"video").length,t.stream.isAudio=t.stream.isAudio,t.stream.isScreen=t.stream.isScreen),t.stream.streamid=t.stream.id,r[t.stream.id]=t.stream,e.onRemoteStream(t.stream),t.stream.getTracks().forEach(function(e){e.onended=function(){o&&o.onremovestream(t)}}),t.stream.onremovetrack=function(){o&&o.onremovestream(t)}}},o.onremovestream=function(t){t.stream.streamid=t.stream.id,r[t.stream.id]&&delete r[t.stream.id],e.onRemoteStreamRemoved(t.stream)},"function"!=typeof o.removeStream&&(o.removeStream=function(e){e.getTracks().forEach(function(t){o.removeTrack(t,e)})}),this.addRemoteCandidate=function(e){o.addIceCandidate(new P(e))},this.addRemoteSdp=function(e,t){t=t||function(){},"Safari"!==DetectRTC.browser.name&&(e.sdp=s.processSdp(e.sdp)),o.setRemoteDescription(new R(e)).then(t,function(n){!s.enableLogs||console.error("setRemoteDescription failed","\n",n,"\n",e.sdp),t()})["catch"](function(n){!s.enableLogs||console.error("setRemoteDescription failed","\n",n,"\n",e.sdp),t()})};var l=!0;e.remoteSdp&&(l=!1),this.createDataChannel=function(){var e=o.createDataChannel("sctp",{});t(e)},!0!==s.session.data||a||(l?this.createDataChannel():o.ondatachannel=function(e){var n=e.channel;t(n)}),this.enableDisableVideoEncoding=function(e){var t;if(o.getSenders().forEach(function(e){t||"video"!==e.track.kind||(t=e)}),t&&t.getParameters){var n=t.getParameters();n.encodings[1]&&(n.encodings[1].active=!!e),n.encodings[2]&&(n.encodings[2].active=!!e),t.setParameters(n)}},e.remoteSdp&&(e.remoteSdp.remotePeerSdpConstraints&&(u=e.remoteSdp.remotePeerSdpConstraints),T.sdpConstraints=C(u),this.addRemoteSdp(e.remoteSdp,function(){n("createAnswer")})),("two-way"==s.session.audio||"two-way"==s.session.video||"two-way"==s.session.screen)&&(T.sdpConstraints=C({OfferToReceiveAudio:"two-way"==s.session.audio||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio,OfferToReceiveVideo:"two-way"==s.session.video||"two-way"==s.session.screen||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio}));var f={};o.getLocalStreams().forEach(function(e){f[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),l&&n("createOffer"),o.nativeClose=o.close,o.close=function(){if(o){try{o.nativeClose!==o.close&&o.nativeClose()}catch(t){}o=null,i.peer=null}},this.peer=o}function k(e,t){e.mandatory&&e.mandatory.chromeMediaSource?t.isScreen=!0:e.mozMediaSource||e.mediaSource?t.isScreen=!0:e.video?t.isVideo=!0:e.audio&&(t.isAudio=!0)}function y(e){function t(t,s){k(e.localMediaConstraints,t);var i="ended";"oninactive"in t&&(i="inactive"),t.addEventListener(i,function(){delete currentUserMediaRequest.streams[n],currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.indexOf(e)&&(delete currentUserMediaRequest.queueRequests[currentUserMediaRequest.queueRequests.indexOf(e)],currentUserMediaRequest.queueRequests=m(currentUserMediaRequest.queueRequests))},!1),currentUserMediaRequest.streams[n]={stream:t},currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.length&&y(currentUserMediaRequest.queueRequests.shift()),e.onGettingLocalMedia(t,s)}if(!0===currentUserMediaRequest.mutex&&0<currentUserMediaRequest.queueRequests.length)return void currentUserMediaRequest.queueRequests.push(e);currentUserMediaRequest.mutex=!0;var n=JSON.stringify(e.localMediaConstraints);if(currentUserMediaRequest.streams[n])t(currentUserMediaRequest.streams[n].stream,!0);else{var s=!!/BB10|BlackBerry/i.test(navigator.userAgent||"");if(s||"undefined"==typeof navigator.mediaDevices||"function"!=typeof navigator.mediaDevices.getUserMedia)return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,void navigator.getUserMedia(e.localMediaConstraints,function(e){e.streamid=e.streamid||e.id||a(),e.idInstance=n,t(e)},function(t){e.onLocalMediaError(t,e.localMediaConstraints)});if("undefined"==typeof navigator.mediaDevices){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var i,r,o=function(){},d=function(){};navigator.mediaDevices={getUserMedia:function(e){return navigator.getUserMedia(e,function(e){e(stream),i=stream},function(e){d(e),r=e}),{then:function(e){return i?void e(i):(o=e,{then:function(e){return r?void e(r):void(d=e)}})}}}}}if(!0===e.localMediaConstraints.isScreen){if(navigator.mediaDevices.getDisplayMedia)navigator.mediaDevices.getDisplayMedia(e.localMediaConstraints).then(function(e){e.streamid=e.streamid||e.id||a(),e.idInstance=n,e.isScreen=!0,t(e)})["catch"](function(t){e.onLocalMediaError(t,e.localMediaConstraints)});else if(navigator.getDisplayMedia)navigator.getDisplayMedia(e.localMediaConstraints).then(function(e){e.streamid=e.streamid||e.id||a(),e.idInstance=n,e.isScreen=!0,t(e)})["catch"](function(t){e.onLocalMediaError(t,e.localMediaConstraints)});else throw new Error("getDisplayMedia API is not availabe in this browser.");return}navigator.mediaDevices.getUserMedia(e.localMediaConstraints).then(function(s){s.streamid=s.streamid||s.id||a(),s.idInstance=n,e.session&&s.getTracks().forEach(function(t){e.session.audio||"audio"!==t.kind||(t.enabled=!1),e.session.video||"video"!==t.kind||(t.enabled=!1)}),t(s)})["catch"](function(t){e.onLocalMediaError(t,e.localMediaConstraints)})}}function w(t){var n={};return{receive:function(s,i,r){var o=s.uuid;if(n[o]||(n[o]=[]),n[o].push(s.message),s.last){var a=n[o].join("");s.isobject&&(a=JSON.parse(a));var d=new Date().getTime(),c=d-s.sendingTime,m={data:a,userid:i,extra:r,latency:c};t.autoTranslateText?(m.original=m.data,t.Translator.TranslateText(m.data,function(e){m.data=e,t.onmessage(m)})):t.onmessage(m),delete n[o]}}}}(function(e){e&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},!global.console&&(global.console={}),"undefined"==typeof global.console.debug&&(global.console.debug=global.console.info=global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(e.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},document.addEventListener=document.removeEventListener=e.addEventListener=e.removeEventListener=function(){},e.HTMLVideoElement=e.HTMLMediaElement=function(){}),"undefined"==typeof io&&(e.io=function(){return{on:function(e,t){t=t||function(){},"connect"===e&&t()},emit:function(e,t,n){n=n||function(){},("open-room"===e||"join-room"===e)&&n(!0,t.sessionid,null)}}}),"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:"",origin:"self"}),"undefined"==typeof screen&&(e.screen={width:0,height:0}),"undefined"==typeof URL&&(e.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),e.window=global)})("undefined"==typeof global?null:global),"use strict",function(){function e(){var e,t,n,s=m.appVersion,i=m.userAgent,r=m.appName,o=""+parseFloat(m.appVersion),a=parseInt(m.appVersion,10);if(g&&!v&&-1!==i.indexOf("CriOS")&&(g=!1,v=!0),l){r="Opera";try{o=m.userAgent.split("OPR/")[1].split(" ")[0],a=o.split(".")[0]}catch(t){o="0.0.0.0",a=0}}else h?(t=i.indexOf("rv:"),0<t?o=i.substring(t+3):(t=i.indexOf("MSIE"),o=i.substring(t+5)),r="IE"):v?(t=i.indexOf("Chrome"),r="Chrome",o=i.substring(t+7)):g?(t=i.indexOf("Safari"),r="Safari",o=i.substring(t+7),-1!==(t=i.indexOf("Version"))&&(o=i.substring(t+8)),-1!==m.userAgent.indexOf("Version/")&&(o=m.userAgent.split("Version/")[1].split(" ")[0])):f?(t=i.indexOf("Firefox"),r="Firefox",o=i.substring(t+8)):(e=i.lastIndexOf(" ")+1)<(t=i.lastIndexOf("/"))&&(r=i.substring(e,t),o=i.substring(t+1),r.toLowerCase()===r.toUpperCase()&&(r=m.appName));return p&&(r="Edge",o=m.userAgent.split("Edge/")[1]),-1!==(n=o.search(/[; \)]/))&&(o=o.substring(0,n)),a=parseInt(""+o,10),isNaN(a)&&(o=""+parseFloat(m.appVersion),a=parseInt(m.appVersion,10)),{fullVersion:o,version:a,name:r,isPrivateBrowsing:!1}}function t(e,t){var n=0,s=!1,i=window.setInterval(function(){e()&&(window.clearInterval(i),t(s)),50<n++&&(window.clearInterval(i),s=!0,t(s))},10)}function n(e){var t=e.toLowerCase();if(0===t.indexOf("msie")&&0===t.indexOf("trident"))return!1;var n=/(?:msie|rv:)\s?([\d\.]+)/.exec(t);return!!(n&&10<=parseInt(n[1],10))}function s(){for(var e,t="-",n=m.appVersion,s=m.userAgent,r=t,o=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],a=0;e=o[a];a++)if(e.r.test(s)){r=e.s;break}var d=t;return /Windows/.test(r)&&(/Windows (.*)/.test(r)&&(d=/Windows (.*)/.exec(r)[1]),r="Windows"),"Mac OS X"===r?/Mac OS X (10[\.\_\d]+)/.test(s)&&(d=/Mac OS X (10[\.\_\d]+)/.exec(s)[1]):"Android"===r?/Android ([\.\_\d]+)/.test(s)&&(d=/Android ([\.\_\d]+)/.exec(s)[1]):"iOS"===r?/OS (\d+)_(\d+)_?(\d+)?/.test(s)&&(d=/OS (\d+)_(\d+)_?(\d+)?/.exec(n),d=d[1]+"."+d[2]+"."+(0|d[3])):void 0,{osName:r,osVersion:d}}function i(e){e=(e||m.userAgent).toLowerCase();var t=e.match(/android\s([0-9\.]*)/);return!!t&&t[1]}function r(e,t){function n(t){if(!t)return void e();var n=E.exec(t);if(n){var s=n[1],r=t.match(x);void 0===i[s]&&e(s,r,!0),i[s]=!0}}function s(){var e=c.localDescription.sdp.split("\n");e.forEach(function(e){e&&0===e.indexOf("a=candidate:")&&n(e)})}if("undefined"!=typeof document&&"function"==typeof document.getElementById){var i={},r=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!r){var o=document.getElementById("iframe");if(!o)return;var a=o.contentWindow;r=a.RTCPeerConnection||a.mozRTCPeerConnection||a.webkitRTCPeerConnection}if(r){var d=null;"Chrome"===V.browser&&58>V.browser.version&&(d={optional:[{RtpDataChannels:!0}]});var c=new r({iceServers:[{urls:"stun:stun.l.google.com:19302"}]},d);if(t&&(c.addStream?c.addStream(t):c.addTrack&&t.getTracks()[0]&&c.addTrack(t.getTracks()[0],t)),c.onicecandidate=function(e){e.candidate&&e.candidate.candidate?n(e.candidate.candidate):n()},!t)try{c.createDataChannel("sctp",{})}catch(t){}V.isPromisesSupported?c.createOffer().then(function(e){c.setLocalDescription(e).then(s)}):c.createOffer(function(e){c.setLocalDescription(e,s,function(){})},function(){})}}}function o(e){if(!M)return void(e&&e());if(!m.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(m.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!m.enumerateDevices&&m.enumerateDevices&&(m.enumerateDevices=m.enumerateDevices.bind(m)),!m.enumerateDevices)return void(e&&e());T=[],R=[],P=[],I=[],U=!1,L=!1,A=!1,D=!1,N=!1;var t={};m.enumerateDevices(function(n){n.forEach(function(e){var n={};for(var s in e)try{"function"!=typeof e[s]&&(n[s]=e[s])}catch(t){}t[n.deviceId+n.label+n.kind]||("audio"===n.kind&&(n.kind="audioinput"),"video"===n.kind&&(n.kind="videoinput"),!n.deviceId&&(n.deviceId=n.id),!n.id&&(n.id=n.deviceId),n.label?("videoinput"===n.kind&&!N&&(N=!0),"audioinput"===n.kind&&!D&&(D=!0)):(n.isCustomLabel=!0,n.label="videoinput"===n.kind?"Camera "+(I.length+1):"audioinput"===n.kind?"Microphone "+(R.length+1):"audiooutput"===n.kind?"Speaker "+(P.length+1):"Please invoke getUserMedia once.","undefined"!=typeof V&&V.browser.isChrome&&46<=V.browser.version&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(n.label="HTTPs is required to get label of this "+n.kind+" device.")),"audioinput"===n.kind&&(U=!0,-1===R.indexOf(n)&&R.push(n)),"audiooutput"===n.kind&&(L=!0,-1===P.indexOf(n)&&P.push(n)),"videoinput"===n.kind&&(A=!0,-1===I.indexOf(n)&&I.push(n)),T.push(n),t[n.deviceId+n.label+n.kind]=n)}),"undefined"!=typeof V&&(V.MediaDevices=T,V.hasMicrophone=U,V.hasSpeakers=L,V.hasWebcam=A,V.isWebsiteHasWebcamPermissions=N,V.isWebsiteHasMicrophonePermissions=D,V.audioInputDevices=R,V.audioOutputDevices=P,V.videoInputDevices=I),e&&e()})}var a="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",d="object"===("undefined"==typeof process?"undefined":_typeof(process))&&"object"===_typeof(process.versions)&&process.versions.node&&!process.browser;if(d){var c=process.versions.node.toString().replace("v","");a="Nodejs/"+c+" (NodeOS) AppleWebKit/"+c+" (KHTML, like Gecko) Nodejs/"+c+" Nodejs/"+c}(function(e){"undefined"!=typeof window||("undefined"==typeof window&&"undefined"!=typeof global?(global.navigator={userAgent:a,getUserMedia:function(){}},e.window=global):"undefined"==typeof window,"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(e.screen={width:0,height:0}))})("undefined"==typeof global?window:global);var m=window.navigator;"undefined"==typeof m?m={getUserMedia:function(){},userAgent:a}:("undefined"!=typeof m.webkitGetUserMedia&&(m.getUserMedia=m.webkitGetUserMedia),"undefined"!=typeof m.mozGetUserMedia&&(m.getUserMedia=m.mozGetUserMedia));var u=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(m.userAgent||""),p=-1!==m.userAgent.indexOf("Edge")&&(!!m.msSaveOrOpenBlob||!!m.msSaveBlob),l=!!window.opera||0<=m.userAgent.indexOf(" OPR/"),f="undefined"!=typeof window.InstallTrigger,g=/^((?!chrome|android).)*safari/i.test(m.userAgent),v=!!window.chrome&&!l,h="undefined"!=typeof document&&!!document.documentMode&&!p,S={Android:function(){return m.userAgent.match(/Android/i)},BlackBerry:function(){return m.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return m.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return m.userAgent.match(/Opera Mini/i)},Windows:function(){return m.userAgent.match(/IEMobile/i)},any:function(){return S.Android()||S.BlackBerry()||S.iOS()||S.Opera()||S.Windows()},getOsName:function(){var e="Unknown OS";return S.Android()&&(e="Android"),S.BlackBerry()&&(e="BlackBerry"),S.iOS()&&(e="iOS"),S.Opera()&&(e="Opera Mini"),S.Windows()&&(e="Windows"),e}},C="Unknown OS",b="Unknown OS Version",k=s();k&&k.osName&&"-"!=k.osName?(C=k.osName,b=k.osVersion):S.any()&&(C=S.getOsName(),"Android"==C&&(b=i()));var d="object"===("undefined"==typeof process?"undefined":_typeof(process))&&"object"===_typeof(process.versions)&&process.versions.node;"Unknown OS"===C&&d&&(C="Nodejs",b=process.versions.node.toString().replace("v",""));var y=!1,w=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){"undefined"==typeof document||"function"!=typeof document.createElement||(!y&&e in document.createElement("canvas")&&(y=!0),!w&&e in document.createElement("video")&&(w=!0))});var x=/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/,E=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,T=[],R=[],P=[],I=[];m.mediaDevices&&m.mediaDevices.enumerateDevices&&(m.enumerateDevices=function(e){var t=m.mediaDevices.enumerateDevices();t&&t.then?m.mediaDevices.enumerateDevices().then(e)["catch"](function(){e([])}):e([])});var M=!1;"undefined"!=typeof O&&"getSources"in O?M=!0:m.mediaDevices&&!!m.mediaDevices.enumerateDevices&&(M=!0);var U=!1,L=!1,A=!1,D=!1,N=!1,V=window.DetectRTC||{};V.browser=e(),function(e){var s;try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){s=!1},function(){s=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var i;try{i=window.indexedDB.open("test"),i.onerror=function(){return!0}}catch(t){s=!0}"undefined"==typeof s&&t(function(){return"done"===i.readyState},function(e){e||(s=!i.result)})}else if(n(window.navigator.userAgent)){s=!1;try{window.indexedDB||(s=!0)}catch(t){s=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(t){s=!0}"undefined"==typeof s&&(s=!1,window.localStorage.removeItem("test"))}}catch(t){s=!1}t(function(){return"undefined"!=typeof s},function(){e(s)})}(function(e){V.browser.isPrivateBrowsing=!!e}),V.browser["is"+V.browser.name]=!0,V.osName=C,V.osVersion=b;var B="object"===("undefined"==typeof process?"undefined":_typeof(process))&&"object"===_typeof(process.versions)&&process.versions["node-webkit"],F=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(e){F||e in window&&(F=!0)}),V.isWebRTCSupported=F,V.isORTCSupported="undefined"!=typeof RTCIceGatherer;var W=!1;if(V.browser.isChrome&&35<=V.browser.version?W=!0:V.browser.isFirefox&&34<=V.browser.version?W=!0:V.browser.isEdge&&17<=V.browser.version?W=!0:"Android"===V.osName&&V.browser.isChrome&&(W=!0),!/^(https:|chrome-extension:)$/g.test(location.protocol||"")){var G="undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g);G&&(V.browser.isChrome||V.browser.isEdge||V.browser.isOpera)?W=!1:V.browser.isFirefox&&(W=!1)}V.isScreenCapturingSupported=W;var q={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(e){q.isSupported||e in window&&(q.isSupported=!0,window[e]&&"createMediaStreamSource"in window[e].prototype&&(q.isCreateMediaStreamSourceSupported=!0))}),V.isAudioContextSupported=q.isSupported,V.isCreateMediaStreamSourceSupported=q.isCreateMediaStreamSourceSupported;var H=!1;V.browser.isChrome&&31<V.browser.version&&(H=!0),V.isRtpDataChannelsSupported=H;var j=!1;V.browser.isFirefox&&28<V.browser.version?j=!0:V.browser.isChrome&&25<V.browser.version?j=!0:V.browser.isOpera&&11<=V.browser.version&&(j=!0),V.isSctpDataChannelsSupported=j,V.isMobileDevice=u;var z=!1;m.getUserMedia?z=!0:m.mediaDevices&&m.mediaDevices.getUserMedia&&(z=!0),V.browser.isChrome&&46<=V.browser.version&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(z="Requires HTTPs"),"Nodejs"===V.osName&&(z=!1),V.isGetUserMediaSupported=z;var _="";if(screen.width){var K=screen.width?screen.width:"",J=screen.height?screen.height:"";_+=""+K+" x "+J}V.displayResolution=_,V.displayAspectRatio=function(e,t){function n(e,t){return 0==t?e:n(t,e%t)}var s=n(e,t);return e/s/(t/s)}(screen.width,screen.height).toFixed(2),V.isCanvasSupportsStreamCapturing=y,V.isVideoSupportsStreamCapturing=w,"Chrome"==V.browser.name&&53<=V.browser.version&&(!V.isCanvasSupportsStreamCapturing&&(V.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),!V.isVideoSupportsStreamCapturing&&(V.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features")),V.DetectLocalIPAddress=function(e,t){if(V.isWebRTCSupported){var n=!0,s=!0;r(function(t){t?t.match(x)?(n=!1,e("Local: "+t,n,s)):t.match(/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/)?(s=!1,e("Public: "+t,n,s)):e("Public: "+t,n,s):e()},t)}},V.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,V.isWebSocketsBlocked=!V.isWebSocketsSupported,"Nodejs"===V.osName&&(V.isWebSocketsSupported=!0,V.isWebSocketsBlocked=!1),V.checkWebSocketsSupport=function(t){t=t||function(){};try{var n,s=new WebSocket("wss://echo.websocket.org:443/");s.onopen=function(){V.isWebSocketsBlocked=!1,n=new Date().getTime(),s.send("ping")},s.onmessage=function(){V.WebsocketLatency=new Date().getTime()-n+"ms",t(),s.close(),s=null},s.onerror=function(){V.isWebSocketsBlocked=!0,t()}}catch(n){V.isWebSocketsBlocked=!0,t()}},V.load=function(e){e=e||function(){},o(e)},"function"==typeof o,V.MediaDevices="undefined"==typeof T?[]:T,V.hasMicrophone=U,V.hasSpeakers=L,V.hasWebcam=A,V.isWebsiteHasWebcamPermissions=N,V.isWebsiteHasMicrophonePermissions=D,V.audioInputDevices=R,V.audioOutputDevices=P,V.videoInputDevices=I;var X=!1;"undefined"!=typeof document&&"function"==typeof document.createElement&&"setSinkId"in document.createElement("video")&&(X=!0),V.isSetSinkIdSupported=X;var Y=!1;V.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(Y=!0):V.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(Y=!0),V.isRTPSenderReplaceTracksSupported=Y;var Q=!1;V.browser.isFirefox&&38<V.browser.version&&(Q=!0),V.isRemoteStreamProcessingSupported=Q;var $=!1;"undefined"!=typeof O&&"applyConstraints"in O.prototype&&($=!0),V.isApplyConstraintsSupported=$;var Z=!1;V.browser.isFirefox&&43<=V.browser.version&&(Z=!0),V.isMultiMonitorScreenCapturingSupported=Z,V.isPromisesSupported=!!("Promise"in window),V.version="1.3.9","undefined"==typeof V&&(window.DetectRTC={});var ee=window.MediaStream;"undefined"==typeof ee&&"undefined"!=typeof webkitMediaStream&&(ee=webkitMediaStream),V.MediaStream="undefined"!=typeof ee&&"function"==typeof ee&&Object.keys(ee.prototype),V.MediaStreamTrack="undefined"!=typeof O&&Object.keys(O.prototype);var te=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;V.RTCPeerConnection="undefined"!=typeof te&&Object.keys(te.prototype),window.DetectRTC=V,"undefined"!=typeof module&&(module.exports=V),"function"==typeof define&&define.amd&&define("DetectRTC",[],function(){return V})}(),"undefined"!=typeof cordova&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Crosswalk")&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),window.addEventListener||(window.addEventListener=function(e,t,n){e.attachEvent&&e.attachEvent("on"+t,n)}),window.attachEventListener=function(e,t,n,s){e.addEventListener(t,n,s)};var x=window.MediaStream;"undefined"==typeof x&&"undefined"!=typeof webkitMediaStream&&(x=webkitMediaStream),"undefined"==typeof x||"stop"in x.prototype||(x.prototype.stop=function(){this.getTracks().forEach(function(e){e.stop()})}),window.iOSDefaultAudioOutputDevice=window.iOSDefaultAudioOutputDevice||"speaker",document.addEventListener("deviceready",S,!1),S();var E,T={};"undefined"==typeof window.RTCPeerConnection?"undefined"==typeof mozRTCPeerConnection?"undefined"!=typeof webkitRTCPeerConnection&&(E=webkitRTCPeerConnection):E=mozRTCPeerConnection:E=window.RTCPeerConnection;var R=window.RTCSessionDescription||window.mozRTCSessionDescription,P=window.RTCIceCandidate||window.mozRTCIceCandidate,O=window.MediaStreamTrack,I=function(){function e(e,s){var i=n(e);return i.videoCodecNumbers?"vp8"===s&&i.vp8LineNumber===i.videoCodecNumbers[0]?e:"vp9"===s&&i.vp9LineNumber===i.videoCodecNumbers[0]?e:"h264"===s&&i.h264LineNumber===i.videoCodecNumbers[0]?e:(e=t(e,s,i),e):e}function t(e,t,n,s){var i="";if("vp8"===t){if(!n.vp8LineNumber)return e;i=n.vp8LineNumber}if("vp9"===t){if(!n.vp9LineNumber)return e;i=n.vp9LineNumber}if("h264"===t){if(!n.h264LineNumber)return e;i=n.h264LineNumber}var r=n.videoCodecNumbersOriginal.split("SAVPF")[0]+"SAVPF ",o=[i];return s&&(o=[]),n.videoCodecNumbers.forEach(function(e){e===i||o.push(e)}),r+=o.join(" "),e=e.replace(n.videoCodecNumbersOriginal,r),e}function n(e){var t={};return e.split("\n").forEach(function(e){0===e.indexOf("m=video")&&(t.videoCodecNumbers=[],e.split("SAVPF")[1].split(" ").forEach(function(n){n=n.trim(),n&&n.length&&(t.videoCodecNumbers.push(n),t.videoCodecNumbersOriginal=e)})),-1===e.indexOf("VP8/90000")||t.vp8LineNumber||(t.vp8LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("VP9/90000")||t.vp9LineNumber||(t.vp9LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("H264/90000")||t.h264LineNumber||(t.h264LineNumber=e.replace("a=rtpmap:","").split(" ")[0])}),t}function s(e,t,n){return t?"undefined"!=typeof isFirefox&&isFirefox?e:(n&&(t.screen?300>t.screen&&console.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):console.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),t.screen&&n&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,""),e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.screen+"\r\n")),(t.audio||t.video)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),t.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+t.audio+"\r\n")),t.screen?e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.screen+"\r\n"):t.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.video+"\r\n")),e):e}function i(e,t,n){return r(e,0,-1,t,n)}function r(e,t,n,s,r){for(var o=-1===n?e.length:n,a=t;a<o;++a)if(0===e[a].indexOf(s)&&(!r||-1!==e[a].toLowerCase().indexOf(r.toLowerCase())))return a;return null}function o(e){var t=e.match(/a=rtpmap:(\d+) \w+\/\d+/);return t&&2===t.length?t[1]:null}function a(e,t){t=t||{};var n,s=t.min,r=t.max,a=e.split("\r\n"),d=i(a,"a=rtpmap","VP8/90000");if(d&&(n=o(a[d])),!n)return e;var c,m=i(a,"a=rtpmap","rtx/90000");if(m&&(c=o(a[m])),!m)return e;var u=i(a,"a=fmtp:"+c.toString());if(null!==u){var p="\r\n";p+="a=fmtp:"+n+" x-google-min-bitrate="+(s||"228")+"; x-google-max-bitrate="+(r||"228"),a[u]=a[u].concat(p),e=a.join("\r\n")}return e}function d(e,t){t=t||{};var n,s=e.split("\r\n"),r=i(s,"a=rtpmap","opus/48000");if(r&&(n=o(s[r])),!n)return e;var a=i(s,"a=fmtp:"+n.toString());if(null===a)return e;var d="";return d+="; stereo="+("undefined"==typeof t.stereo?"1":t.stereo),d+="; sprop-stereo="+("undefined"==typeof t["sprop-stereo"]?"1":t["sprop-stereo"]),"undefined"!=typeof t.maxaveragebitrate&&(d+="; maxaveragebitrate="+(t.maxaveragebitrate||1048576)),"undefined"!=typeof t.maxplaybackrate&&(d+="; maxplaybackrate="+(t.maxplaybackrate||1048576)),"undefined"!=typeof t.cbr&&(d+="; cbr="+("undefined"==typeof t.cbr?"1":t.cbr)),"undefined"!=typeof t.useinbandfec&&(d+="; useinbandfec="+t.useinbandfec),"undefined"!=typeof t.usedtx&&(d+="; usedtx="+t.usedtx),"undefined"!=typeof t.maxptime&&(d+="\r\na=maxptime:"+t.maxptime),s[a]=s[a].concat(d),e=s.join("\r\n"),e}return{removeVPX:function(e){var s=n(e);return e=t(e,"vp9",s,!0),e=t(e,"vp8",s,!0),e},disableNACK:function(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return e=e.replace("a=rtcp-fb:126 nack\r\n",""),e=e.replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n"),e=e.replace("a=rtcp-fb:97 nack\r\n",""),e=e.replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n"),e},prioritize:function(e,t){if(t&&t.getSenders&&t.getSenders().length){if(!e||"string"!=typeof e)throw"Invalid arguments.";t.getSenders().forEach(function(t){for(var n=t.getParameters(),s=0;s<n.codecs.length;s++)if(n.codecs[s].mimeType==e){n.codecs.unshift(n.codecs.splice(s,1));break}t.setParameters(n)})}},removeNonG722:function(e){return e.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")},setApplicationSpecificBandwidth:function(e,t,n){return s(e,t,n)},setVideoBitrates:function(e,t){return a(e,t)},setOpusAttributes:function(e,t){return d(e,t)},preferVP9:function(t){return e(t,"vp9")},preferCodec:e,forceStereoAudio:function(e){for(var t=e.split("\r\n"),n=null,s=0;s<t.length;s++)if(-1!==t[s].search("opus/48000")){var r=extractSdp(t[s],/:(\d+) opus\/48000/i);break}for(var s=0;s<t.length;s++)if(-1!==t[s].search("a=fmtp")){var o=extractSdp(t[s],/a=fmtp:(\d+)/);if(o===r){n=s;break}}return null===n?e:(t[n]=t[n].concat("; stereo=1; sprop-stereo=1"),e=t.join("\r\n"),e)}}}();window.BandwidthHandler=I;var M=function(){return{processCandidates:function(e,t){var n=t.candidate,s=e.candidates,i=s.stun,r=s.turn;if((p(s.reflexive)||(i=s.reflexive),p(s.relay)||(r=s.relay),s.host||!n.match(/typ host/g))&&(r||!n.match(/typ relay/g))&&(i||!n.match(/typ srflx/g))){var o=e.iceProtocols;if(o.udp||!n.match(/ udp /g))return o.tcp||!n.match(/ tcp /g)?(e.enableLogs&&console.debug("Your candidate pairs:",n),{candidate:n,sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex}):void 0}}}}(),U=function(){return{getIceServers:function(){return[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun.l.google.com:19302?transport=udp"]}]}}}();window.currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[],remove:function(e){this.mutex=!1;var t=this.streams[e];if(t){t=t.stream;var n=t.currentUserMediaRequestOptions;this.queueRequests.indexOf(n)&&(delete this.queueRequests[this.queueRequests.indexOf(n)],this.queueRequests=m(this.queueRequests)),this.streams[e].stream=null,delete this.streams[e]}}};var L=function(){function e(e){return e?"string"==typeof e||"undefined"==typeof e?e:e.audio&&e.video?null:e.audio?"audio":e.video?"video":void 0:void 0}function t(t,s,r){function o(){if(r.streamEvents[t.streamid].mediaElement){var s=r.streamEvents[t.streamid].mediaElement;s.volume=0,n(200,5,function(){try{s.volume+=.2}catch(t){s.volume=1}})}}if(t&&t.addEventListener){if("undefined"==typeof s||!0==s){var a="ended";"oninactive"in t&&(a="inactive"),t.addEventListener(a,function(){L.onSyncNeeded(this.streamid,a)},!1)}t.mute=function(n,o){n=e(n),"undefined"!=typeof o&&(s=o),("undefined"==typeof n||"audio"==n)&&g(t,"audio").forEach(function(e){e.enabled=!1,r.streamEvents[t.streamid].isAudioMuted=!0}),("undefined"==typeof n||"video"==n)&&g(t,"video").forEach(function(e){e.enabled=!1}),("undefined"==typeof s||!0==s)&&L.onSyncNeeded(t.streamid,"mute",n),r.streamEvents[t.streamid].muteType=n||"both",i(t,"mute",n)},t.unmute=function(n,a){n=e(n),"undefined"!=typeof a&&(s=a),o(),("undefined"==typeof n||"audio"==n)&&g(t,"audio").forEach(function(e){e.enabled=!0,r.streamEvents[t.streamid].isAudioMuted=!1}),("undefined"==typeof n||"video"==n)&&g(t,"video").forEach(function(e){e.enabled=!0}),("undefined"==typeof s||!0==s)&&L.onSyncNeeded(t.streamid,"unmute",n),r.streamEvents[t.streamid].unmuteType=n||"both",i(t,"unmute",n)}}}function n(e,t,s,i){i=(i||0)+1;i>=t||setTimeout(function(){s(),n(e,t,s,i)},e)}return{setHandlers:t,onSyncNeeded:function(){}}}(),A={send:function(e){function t(e,r){var a={type:"text",uuid:m,sendingTime:u};e&&(r=e,a.packets=parseInt(r.length/o)),r.length>o?a.message=r.slice(0,o):(a.message=r,a.last=!0,a.isobject=c),s.send(a,i),d=r.slice(a.message.length),d.length&&setTimeout(function(){t(null,d)},n.chunkInterval||100)}var n=e.connection,s=e.channel,i=e.remoteUserId,r=e.text,o=n.chunkSize||1e3,d="",c=!1;l(r)||(c=!0,r=JSON.stringify(r));var m=a(),u=new Date().getTime();t(r)}},D=function(){return{handle:function(e){function t(e,t){if(-1!==e.position){var n=+e.position.toFixed(2).split(".")[1]||100;t.innerHTML=n+"%"}}var n={};e.onFileStart=function(t){var s=document.createElement("div");return s.title=t.name,s.innerHTML="<label>0%</label> <progress></progress>",t.remoteUserId&&(s.innerHTML+=" (Sharing with:"+t.remoteUserId+")"),e.filesContainer||(e.filesContainer=document.body||document.documentElement),e.filesContainer.insertBefore(s,e.filesContainer.firstChild),t.remoteUserId?void(!n[t.uuid]&&(n[t.uuid]={}),n[t.uuid][t.remoteUserId]={div:s,progress:s.querySelector("progress"),label:s.querySelector("label")},n[t.uuid][t.remoteUserId].progress.max=t.maxChunks):(n[t.uuid]={div:s,progress:s.querySelector("progress"),label:s.querySelector("label")},void(n[t.uuid].progress.max=t.maxChunks))},e.onFileProgress=function(e){var s=n[e.uuid];!s||e.remoteUserId&&(s=n[e.uuid][e.remoteUserId],!s)||(s.progress.value=e.currentPosition||e.maxChunks||s.progress.max,t(s.progress,s.label))},e.onFileEnd=function(e){var t=n[e.uuid];if(!t)return void console.error("No such progress-helper element exist.",e);if(!(e.remoteUserId&&(t=n[e.uuid][e.remoteUserId],!t))){var s=t.div;s.innerHTML=-1==e.type.indexOf("image")?"<a href=\""+e.url+"\" download=\""+e.name+"\">Download <strong style=\"color:red;\">"+e.name+"</strong> </a><br /><iframe src=\""+e.url+"\" title=\""+e.name+"\" style=\"width: 80%;border: 0;height: inherit;margin-top:1em;\"></iframe>":"<a href=\""+e.url+"\" download=\""+e.name+"\">Download <strong style=\"color:red;\">"+e.name+"</strong> </a><br /><img src=\""+e.url+"\" title=\""+e.name+"\" style=\"max-width: 80%;\">"}}}}}(),N=function(){return{handle:function(e){e.autoTranslateText=!1,e.language="en",e.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",e.Translator={TranslateText:function(t,n){var s=document.createElement("script");s.type="text/javascript";var i=encodeURIComponent(t),r="method"+e.token();window[r]=function(e){return e.data&&e.data.translations[0]&&n?void n(e.data.translations[0].translatedText):e.error&&"Daily Limit Exceeded"===e.error.message?void console.error("Text translation failed. Error message: \"Daily Limit Exceeded.\""):e.error?void console.error(e.error.message):void console.error(e)};var o="https://www.googleapis.com/language/translate/v2?key="+e.googKey+"&target="+(e.language||"en-US")+"&callback=window."+r+"&q="+i;s.src=o,document.getElementsByTagName("head")[0].appendChild(s)},getListOfLanguages:function(t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState==XMLHttpRequest.DONE){var e=JSON.parse(n.responseText);if(e&&e.data&&e.data.languages)return void t(e.data.languages);if(e.error&&"Daily Limit Exceeded"===e.error.message)return void console.error("Text translation failed. Error message: \"Daily Limit Exceeded.\"");if(e.error)return void console.error(e.error.message);console.error(e)}};var s="https://www.googleapis.com/language/translate/v2/languages?key="+e.googKey+"&target=en";n.open("GET",s,!0),n.send(null)}}}}}();(function(i){function m(e){if(i.socketAutoReConnect=!0,i.socket)return void(e&&e(i.socket));if("undefined"==typeof n)if("undefined"!=typeof FirebaseConnection)window.SocketConnection=FirebaseConnection;else if("undefined"!=typeof PubNubConnection)window.SocketConnection=PubNubConnection;else throw"SocketConnection.js seems missed.";new n(i,function(){e&&e(i.socket)})}function p(e,t){i.socket.emit("join-room",{sessionid:i.sessionid,session:i.session,mediaConstraints:i.mediaConstraints,sdpConstraints:i.sdpConstraints,streams:h(),extra:i.extra,password:"undefined"!=typeof i.password&&"object"!==_typeof(i.password)?i.password:""},function(n,s){if(!0===n){if(i.enableLogs&&console.log("isRoomJoined: ",n," roomid: ",i.sessionid),!!i.peers[i.sessionid])return;k.onNegotiationNeeded(e)}!1===n&&(i.enableLogs&&console.warn("isRoomJoined: ",s," roomid: ",i.sessionid),!1),t(n,i.sessionid,s)})}function l(e){i.enableLogs&&console.log("Sending open-room signal to socket.io"),i.waitingForLocalMedia=!1,i.socket.emit("open-room",{sessionid:i.sessionid,session:i.session,mediaConstraints:i.mediaConstraints,sdpConstraints:i.sdpConstraints,streams:h(),extra:i.extra,identifier:i.publicRoomIdentifier,password:"undefined"!=typeof i.password&&"object"!==_typeof(i.password)?i.password:""},function(t,n){!0===t&&(i.enableLogs&&console.log("isRoomOpened: ",t," roomid: ",i.sessionid),e(t,i.sessionid)),!1===t&&(i.enableLogs&&console.warn("isRoomOpened: ",n," roomid: ",i.sessionid),e(t,i.sessionid,n))})}function h(){try{return i.streamEvents.selectAll("local").map(function(e){return{streamid:e.streamid,tracks:e.stream.getTracks().length}})}catch(t){return[]}}function S(e,t){if(i.dontCaptureUserMedia||e.isDataOnly)return void t();var n={};e.localPeerSdpConstraints.OfferToReceiveAudio&&(n.audio=i.mediaConstraints.audio),e.localPeerSdpConstraints.OfferToReceiveVideo&&(n.video=i.mediaConstraints.video);var s=e.session||i.session;return s.oneway&&"two-way"!==s.audio&&"two-way"!==s.video&&"two-way"!==s.screen?void t():void(s.oneway&&s.audio&&"two-way"===s.audio&&(s={audio:!0}),(s.audio||s.video||s.screen)&&(s.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:f(i)}).then(function(e){e.isScreen=!0,k.onGettingLocalMedia(e),(s.audio||s.video)&&!f(i)?i.invokeGetUserMedia(null,t):t(e)},function(){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):i.invokeGetUserMedia({audio:f(i),video:!0,isScreen:!0},(s.audio||s.video)&&!f(i)?i.invokeGetUserMedia(null,t):t):(s.audio||s.video)&&i.invokeGetUserMedia(null,t,s)))}function C(e,t){return e?void(t.audio&&g(e,"audio").forEach(function(e){e.applyConstraints(t.audio)}),t.video&&g(e,"video").forEach(function(e){e.applyConstraints(t.video)})):void(!i.enableLogs||console.error("No stream to applyConstraints."))}function b(e,t,n){return t?void k.replaceTrack(e,t,n):void i.peers.getAllParticipants().forEach(function(t){k.replaceTrack(e,t,n)})}t=t||{useDefaultDevices:!0},i.channel=i.sessionid=(e||location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""))+"";var k=new s(i),w={};k.onGettingLocalMedia=function(e,t){if(t=t||function(){},w[e.streamid])return void t();w[e.streamid]=!0;try{e.type="local"}catch(t){}i.setStreamEndHandler(e),d(e,function(n){n.id=e.streamid,n.muted=!0,n.volume=0,-1===i.attachStreams.indexOf(e)&&i.attachStreams.push(e),"undefined"!=typeof L&&L.setHandlers(e,!0,i),i.streamEvents[e.streamid]={stream:e,type:"local",mediaElement:n,userid:i.userid,extra:i.extra,streamid:e.streamid,isAudioMuted:!0};try{r(i,i.streamEvents[e.streamid]),o(i,i.streamEvents[e.streamid]),i.onstream(i.streamEvents[e.streamid])}catch(t){console.error(t)}t()},i)},k.onGettingRemoteMedia=function(e,t){try{e.type="remote"}catch(t){}i.setStreamEndHandler(e,"remote-stream"),d(e,function(){var n=_asyncToGenerator(regeneratorRuntime.mark(function n(s){var a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:a=function(e){return new Promise(function(t){return setTimeout(t,e)})},s.id=e.streamid,"undefined"!=typeof L&&L.setHandlers(e,!1,i);case 3:if(i.peers[t].extra){n.next=8;break}return n.next=6,a(100);case 6:n.next=3;break;case 8:i.streamEvents[e.streamid]={stream:e,type:"remote",userid:t,extra:i.peers[t]?i.peers[t].extra:{},mediaElement:s,streamid:e.streamid};try{r(i,i.streamEvents[e.streamid]),o(i,i.streamEvents[e.streamid]),i.onstream(i.streamEvents[e.streamid])}catch(t){console.error(t)}case 10:case"end":return n.stop();}},n)}));return function(){return n.apply(this,arguments)}}(),i)},k.onRemovingRemoteMedia=function(e,t){var n=i.streamEvents[e.streamid];n||(n={stream:e,type:"remote",userid:t,extra:i.peers[t]?i.peers[t].extra:{},streamid:e.streamid,mediaElement:i.streamEvents[e.streamid]?i.streamEvents[e.streamid].mediaElement:null}),i.peersBackup[n.userid]&&(n.extra=i.peersBackup[n.userid].extra),i.onstreamended(n),delete i.streamEvents[e.streamid]},k.onNegotiationNeeded=function(e,t,n){n=n||function(){},t=t||e.remoteUserId,e=e||"";var s={remoteUserId:t,message:e,sender:i.userid};e.remoteUserId&&e.message&&e.sender&&(s=e),m(function(){i.socket.emit(i.socketMessageEvent,s,n)})},k.onUserLeft=function(e){i.deletePeer(e)},k.disconnectWith=function(e,t){i.socket&&i.socket.emit("disconnect-with",e,t||function(){}),i.deletePeer(e)},i.socketOptions={transport:"polling"},i.openOrJoin=function(e,t){t=t||function(){},i.checkPresence(e,function(e,n){if(e){i.sessionid=n;var s=!1,r=!1,o=!!i.session.oneway,a=u(i.session);r={OfferToReceiveAudio:i.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:i.sdpConstraints.mandatory.OfferToReceiveVideo},s={OfferToReceiveAudio:o?!!i.session.audio:i.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:o?!!i.session.video||!!i.session.screen:i.sdpConstraints.mandatory.OfferToReceiveVideo};var d={remoteUserId:i.sessionid,message:{newParticipationRequest:!0,isOneWay:o,isDataOnly:a,localPeerSdpConstraints:s,remotePeerSdpConstraints:r},sender:i.userid};return void S(d.message,function(){p(d,t)})}return i.waitingForLocalMedia=!0,i.isInitiator=!0,i.sessionid=n||i.sessionid,u(i.session)?void l(t):void i.captureUserMedia(function(){l(t)})})},i.waitingForLocalMedia=!1,i.open=function(e,t){t=t||function(){},i.waitingForLocalMedia=!0,i.isInitiator=!0,i.sessionid=e||i.sessionid,m(function(){return u(i.session)?void l(t):void i.captureUserMedia(function(){l(t)})})},i.peersBackup={},i.deletePeer=function(e){if(e&&i.peers[e]){var t={userid:e,extra:i.peers[e]?i.peers[e].extra:{}};if(i.peersBackup[t.userid]&&(t.extra=i.peersBackup[t.userid].extra),i.onleave(t),!!i.peers[e]){i.peers[e].streams.forEach(function(e){e.stop()});var n=i.peers[e].peer;if(n&&"closed"!==n.iceConnectionState)try{n.close()}catch(t){}i.peers[e]&&(i.peers[e].peer=null,delete i.peers[e])}}},i.rejoin=function(e){if(!i.isInitiator&&e&&Object.keys(e).length){var t={};i.peers[e.remoteUserId]&&(t=i.peers[e.remoteUserId].extra,i.deletePeer(e.remoteUserId)),e&&e.remoteUserId&&(i.join(e.remoteUserId),i.onReConnecting({userid:e.remoteUserId,extra:t}))}},i.join=function(e,t){i.sessionid=!!e&&(e.sessionid||e.remoteUserId||e)||i.sessionid,i.sessionid+="";var n=!1,s=!1,r=!1,o=!1;if(e&&e.session||!e||"string"==typeof e){var a=e?e.session||i.session:i.session;r=!!a.oneway,o=u(a),s={OfferToReceiveAudio:i.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:i.sdpConstraints.mandatory.OfferToReceiveVideo},n={OfferToReceiveAudio:r?!!i.session.audio:i.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:r?!!i.session.video||!!i.session.screen:i.sdpConstraints.mandatory.OfferToReceiveVideo}}t=t||{};var d=function(){};"function"==typeof t&&(d=t,t={}),"undefined"!=typeof t.localPeerSdpConstraints&&(n=t.localPeerSdpConstraints),"undefined"!=typeof t.remotePeerSdpConstraints&&(s=t.remotePeerSdpConstraints),"undefined"!=typeof t.isOneWay&&(r=t.isOneWay),"undefined"!=typeof t.isDataOnly&&(o=t.isDataOnly);var c={remoteUserId:i.sessionid,message:{newParticipationRequest:!0,isOneWay:r,isDataOnly:o,localPeerSdpConstraints:n,remotePeerSdpConstraints:s},sender:i.userid};return S(c.message,function(){m(function(){p(c,d)})}),c},i.publicRoomIdentifier="",i.getUserMedia=i.captureUserMedia=function(e,t){e=e||function(){};var n=t||i.session;return i.dontCaptureUserMedia||u(n)?void e():void((n.audio||n.video||n.screen)&&(n.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:f(i)}).then(function(r){if(r.isScreen=!0,k.onGettingLocalMedia(r),(n.audio||n.video)&&!f(i)){var o={};for(var a in n)"screen"!=a&&(o[a]=n[a]);return void i.invokeGetUserMedia(t,e,o)}e(r)},function(){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):i.invokeGetUserMedia({audio:f(i),video:!0,isScreen:!0},function(r){if((n.audio||n.video)&&!f(i)){var o={};for(var a in n)"screen"!=a&&(o[a]=n[a]);return void i.invokeGetUserMedia(t,e,o)}e(r)}):(n.audio||n.video)&&i.invokeGetUserMedia(t,e,n)))},i.onbeforeunload=function(e,t){i.closeBeforeUnload&&(i.peers.getAllParticipants().forEach(function(e){k.onNegotiationNeeded({userLeft:!0},e),i.peers[e]&&i.peers[e].peer&&i.peers[e].peer.close(),delete i.peers[e]}),!t&&i.closeSocket(),i.isInitiator=!1)},window.ignoreBeforeUnload?i.closeBeforeUnload=!1:(i.closeBeforeUnload=!0,window.addEventListener("beforeunload",i.onbeforeunload,!1)),i.userid=a(),i.changeUserId=function(e,t){t=t||function(){},i.userid=e||a(),i.socket.emit("changed-uuid",i.userid,t)},i.extra={},i.attachStreams=[],i.session={audio:!0,video:!0},i.enableFileSharing=!1,i.bandwidth={screen:!1,audio:!1,video:!1},i.codecs={audio:"opus",video:"VP9"},i.processSdp=function(e){return v()?e:"Safari"===DetectRTC.browser.name?e:("VP8"===i.codecs.video.toUpperCase()&&(e=I.preferCodec(e,"vp8")),"VP9"===i.codecs.video.toUpperCase()&&(e=I.preferCodec(e,"vp9")),"H264"===i.codecs.video.toUpperCase()&&(e=I.preferCodec(e,"h264")),"G722"===i.codecs.audio&&(e=I.removeNonG722(e)),"Firefox"===DetectRTC.browser.name)?e:((i.bandwidth.video||i.bandwidth.screen)&&(e=I.setApplicationSpecificBandwidth(e,i.bandwidth,!!i.session.screen)),i.bandwidth.video&&(e=I.setVideoBitrates(e,{min:1024*(8*i.bandwidth.video),max:1024*(8*i.bandwidth.video)})),i.bandwidth.audio&&(e=I.setOpusAttributes(e,{maxaveragebitrate:1024*(8*i.bandwidth.audio),maxplaybackrate:1024*(8*i.bandwidth.audio),stereo:1,maxptime:3})),e)},"undefined"!=typeof I&&(i.BandwidthHandler=i.CodecsHandler=I),i.mediaConstraints={audio:{mandatory:{},optional:i.bandwidth.audio?[{bandwidth:1024*(8*i.bandwidth.audio)||1048576}]:[]},video:{mandatory:{},optional:i.bandwidth.video?[{bandwidth:1024*(8*i.bandwidth.video)||1048576},{facingMode:"user"}]:[{facingMode:"user"}]}},"Firefox"===DetectRTC.browser.name&&(i.mediaConstraints={audio:!0,video:!0}),t.useDefaultDevices||DetectRTC.isMobileDevice||DetectRTC.load(function(){var e,t;if(DetectRTC.MediaDevices.forEach(function(n){"audioinput"===n.kind&&!1!==i.mediaConstraints.audio&&(e=n),"videoinput"===n.kind&&!1!==i.mediaConstraints.video&&(t=n)}),e){if("Firefox"===DetectRTC.browser.name)return void(!0===i.mediaConstraints.audio?i.mediaConstraints.audio={deviceId:e.id}:i.mediaConstraints.audio.deviceId=e.id);!0==i.mediaConstraints.audio&&(i.mediaConstraints.audio={mandatory:{},optional:[]}),i.mediaConstraints.audio.optional||(i.mediaConstraints.audio.optional=[]);var n=[{sourceId:e.id}];i.mediaConstraints.audio.optional=n.concat(i.mediaConstraints.audio.optional)}if(t){if("Firefox"===DetectRTC.browser.name)return void(!0===i.mediaConstraints.video?i.mediaConstraints.video={deviceId:t.id}:i.mediaConstraints.video.deviceId=t.id);!0==i.mediaConstraints.video&&(i.mediaConstraints.video={mandatory:{},optional:[]}),i.mediaConstraints.video.optional||(i.mediaConstraints.video.optional=[]);var n=[{sourceId:t.id}];i.mediaConstraints.video.optional=n.concat(i.mediaConstraints.video.optional)}}),i.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[{VoiceActivityDetection:!1}]},i.sdpSemantics=null,i.iceCandidatePoolSize=null,i.bundlePolicy=null,i.rtcpMuxPolicy=null,i.iceTransportPolicy=null,i.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300},{googIPv6:!0},{googDscp:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:!0},{googCpuOveruseDetection:!0}],mandatory:{}},i.iceServers=U.getIceServers(i),i.candidates={host:!0,stun:!0,turn:!0},i.iceProtocols={tcp:!0,udp:!0},i.onopen=function(e){!i.enableLogs||console.info("Data connection has been opened between you & ",e.userid)},i.onclose=function(e){!i.enableLogs||console.warn("Data connection has been closed between you & ",e.userid)},i.onerror=function(e){!i.enableLogs||console.error(e.userid,"data-error",e)},i.onmessage=function(e){!i.enableLogs||console.debug("data-message",e.userid,e.data)},i.send=function(e,t){i.peers.send(e,t)},i.close=i.disconnect=i.leave=function(){i.onbeforeunload(!1,!0)},i.closeEntireSession=function(e){e=e||function(){},i.socket.emit("close-entire-session",function t(){return i.getAllParticipants().length?void setTimeout(t,100):void(i.onEntireSessionClosed({sessionid:i.sessionid,userid:i.userid,extra:i.extra}),i.changeUserId(null,function(){i.close(),e()}))})},i.onEntireSessionClosed=function(e){i.enableLogs&&console.info("Entire session is closed: ",e.sessionid,e.extra)},i.onstream=function(t){var e=i.videosContainer;e.insertBefore(t.mediaElement,e.firstChild);var n=t.mediaElement.play();return"undefined"==typeof n?void setTimeout(function(){t.mediaElement.play()},2e3):void n["catch"](function(){}).then(function(){setTimeout(function(){t.mediaElement.play()},2e3)})},i.onstreamended=function(t){t.mediaElement||(t.mediaElement=document.getElementById(t.streamid)),t.mediaElement&&t.mediaElement.parentNode&&t.mediaElement.parentNode.removeChild(t.mediaElement)},i.direction="many-to-many",i.removeStream=function(e,t){var n;return i.attachStreams.forEach(function(t){t.id===e&&(n=t)}),n?void(i.peers.getAllParticipants().forEach(function(e){if(!(t&&e!==t)){var s=i.peers[e];try{s.peer.removeStream(n)}catch(t){}}}),i.renegotiate()):void console.warn("No such stream exist.",e)},i.addStream=function(e,t){function n(n){e.streamCallback&&e.streamCallback(n),i.session=Object.assign(i.session,e),i.renegotiate(t)}return e.getTracks?(-1===i.attachStreams.indexOf(e)&&(!e.streamid&&(e.streamid=e.id),i.attachStreams.push(e)),void i.renegotiate(t)):u(e)?void i.renegotiate(t):void(i.session=Object.assign(i.session,e),(e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:f(i)}).then(function(t){t.isScreen=!0,k.onGettingLocalMedia(t),(e.audio||e.video)&&!f(i)?i.invokeGetUserMedia(null,n):n(t)},function(){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):i.invokeGetUserMedia({audio:f(i),video:!0,isScreen:!0},function(t){(e.audio||e.video)&&!f(i)?i.invokeGetUserMedia(null,function(e){n(e)}):n(t)}):(e.audio||e.video)&&i.invokeGetUserMedia(null,n)))},i.invokeGetUserMedia=function(e,t,n){n||(n=i.session),e||(e=i.mediaConstraints),y({session:n,onGettingLocalMedia:function(n){var s=e.video;s&&(s.mediaSource||s.mozMediaSource?n.isScreen=!0:s.mandatory&&s.mandatory.chromeMediaSource&&(n.isScreen=!0)),n.isScreen||(n.isVideo=!!g(n,"video").length,n.isAudio=!n.isVideo&&g(n,"audio").length),k.onGettingLocalMedia(n,function(){"function"==typeof t&&t(n)})},onLocalMediaError:function(e,t){k.onLocalMediaError(e,t)},localMediaConstraints:e||{audio:!!n.audio&&e.audio,video:!!n.video&&e.video}})},i.applyConstraints=function(e,t){if(!O||!O.prototype.applyConstraints)return void alert("track.applyConstraints is NOT supported in your browser.");if(t){var n;return i.streamEvents[t]&&(n=i.streamEvents[t].stream),void C(n,e)}i.attachStreams.forEach(function(t){C(t,e)})},i.replaceTrack=function(e,t,n){function s(s){i.replaceTrack(s,t,n||e.video||e.screen)}if(e=e||{},!E.prototype.getSenders)return void i.addStream(e);if(e instanceof O)return void b(e,t,n);if(e instanceof x)return g(e,"video").length&&b(g(e,"video")[0],t,!0),void(g(e,"audio").length&&b(g(e,"audio")[0],t,!1));if(u(e)){throw"connection.replaceTrack requires audio and/or video and/or screen."}(e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:f(i)}).then(function(t){t.isScreen=!0,k.onGettingLocalMedia(t),(e.audio||e.video)&&!f(i)?i.invokeGetUserMedia(null,s):s(t)},function(){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):i.invokeGetUserMedia({audio:f(i),video:!0,isScreen:!0},(e.audio||e.video)&&!f(i)?i.invokeGetUserMedia(null,s):s):(e.audio||e.video)&&i.invokeGetUserMedia(null,s))},i.resetTrack=function(e,t){e||(e=i.getAllParticipants()),"string"==typeof e&&(e=[e]),e.forEach(function(e){var n=i.peers[e].peer;("undefined"==typeof t||!0===t)&&n.lastVideoTrack&&i.replaceTrack(n.lastVideoTrack,e,!0),("undefined"==typeof t||!1===t)&&n.lastAudioTrack&&i.replaceTrack(n.lastAudioTrack,e,!1)})},i.renegotiate=function(e){return e?void k.renegotiatePeer(e):void i.peers.getAllParticipants().forEach(function(e){k.renegotiatePeer(e)})},i.setStreamEndHandler=function(e,t){if(e&&e.addEventListener&&(t=!!t,!e.alreadySetEndHandler)){e.alreadySetEndHandler=!0;var n="ended";"oninactive"in e&&(n="inactive"),e.addEventListener(n,function(){if(e.idInstance&&currentUserMediaRequest.remove(e.idInstance),!t){var n=[];i.attachStreams.forEach(function(t){t.id!=e.id&&n.push(t)}),i.attachStreams=n}var s=i.streamEvents[e.streamid];if(s||(s={stream:e,streamid:e.streamid,type:t?"remote":"local",userid:i.userid,extra:i.extra,mediaElement:i.streamEvents[e.streamid]?i.streamEvents[e.streamid].mediaElement:null}),t&&i.peers[s.userid]){var r=i.peers[s.userid].peer,n=[];r.getRemoteStreams().forEach(function(t){t.id!=e.id&&n.push(t)}),i.peers[s.userid].streams=n}s.userid===i.userid&&"remote"===s.type||(i.peersBackup[s.userid]&&(s.extra=i.peersBackup[s.userid].extra),i.onstreamended(s),delete i.streamEvents[e.streamid])},!1)}},i.onMediaError=function(e,t){!i.enableLogs||console.error(e,t)},i.autoCloseEntireSession=!1,i.filesContainer=i.videosContainer=document.body||document.documentElement,i.isInitiator=!1,i.shareFile=k.shareFile,"undefined"!=typeof D&&D.handle(i),"undefined"!=typeof N&&N.handle(i),i.token=a,i.onNewParticipant=function(e,t){i.acceptParticipationRequest(e,t)},i.acceptParticipationRequest=function(e,t){t.successCallback&&(t.successCallback(),delete t.successCallback),k.createNewPeer(e,t)},"undefined"!=typeof L&&(i.StreamsHandler=L),i.onleave=function(){},i.invokeSelectFileDialog=function(e){var t=new FileSelector;t.accept="*.*",t.selectSingleFile(e)},i.onmute=function(t){if(t&&t.mediaElement)if("both"===t.muteType||"video"===t.muteType){t.mediaElement.src=null;var e=t.mediaElement.pause();"undefined"==typeof e?t.mediaElement.poster=t.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png":e.then(function(){t.mediaElement.poster=t.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"})}else"audio"===t.muteType&&(t.mediaElement.muted=!0)},i.onunmute=function(t){t&&t.mediaElement&&t.stream&&("both"===t.unmuteType||"video"===t.unmuteType?(t.mediaElement.poster=null,t.mediaElement.srcObject=t.stream,t.mediaElement.play()):"audio"===t.unmuteType&&(t.mediaElement.muted=!1))},i.onExtraDataUpdated=function(e){e.status="online",i.onUserStatusChanged(e,!0)},i.getAllParticipants=function(e){return i.peers.getAllParticipants(e)},"undefined"!=typeof L&&(L.onSyncNeeded=function(e,t,n){i.peers.getAllParticipants().forEach(function(s){k.onNegotiationNeeded({streamid:e,action:t,streamSyncNeeded:!0,type:n||"both"},s)})}),i.connectSocket=function(e){m(e)},i.closeSocket=function(){try{io.sockets={}}catch(t){}i.socket&&("function"==typeof i.socket.disconnect&&i.socket.disconnect(),"function"==typeof i.socket.resetProps&&i.socket.resetProps(),i.socket=null)},i.getSocket=function(e){return!e&&i.enableLogs&&console.warn("getSocket.callback paramter is required."),e=e||function(){},i.socket?e(i.socket):m(function(){e(i.socket)}),i.socket},i.getRemoteStreams=k.getRemoteStreams;var T=["selectFirst","selectAll","forEach"];if(i.streamEvents={selectFirst:function(e){return i.streamEvents.selectAll(e)[0]},selectAll:function(e){e||(e={local:!0,remote:!0,isScreen:!0,isAudio:!0,isVideo:!0}),"local"==e&&(e={local:!0}),"remote"==e&&(e={remote:!0}),"screen"==e&&(e={isScreen:!0}),"audio"==e&&(e={isAudio:!0}),"video"==e&&(e={isVideo:!0});var t=[];return Object.keys(i.streamEvents).forEach(function(n){var s=i.streamEvents[n];if(-1===T.indexOf(n)){var r=!0;e.local&&"local"===s.type&&(r=!1),e.remote&&"remote"===s.type&&(r=!1),e.isScreen&&s.stream.isScreen&&(r=!1),e.isVideo&&s.stream.isVideo&&(r=!1),e.isAudio&&s.stream.isAudio&&(r=!1),e.userid&&s.userid===e.userid&&(r=!1),!1==r&&t.push(s)}}),t}},i.socketURL="/",i.socketMessageEvent="RTCMultiConnection-Message",i.socketCustomEvent="RTCMultiConnection-Custom-Message",i.DetectRTC=DetectRTC,i.setCustomSocketEvent=function(e){e&&(i.socketCustomEvent=e),i.socket&&i.socket.emit("set-custom-socket-event-listener",i.socketCustomEvent)},i.getNumberOfBroadcastViewers=function(e,t){i.socket&&e&&t&&i.socket.emit("get-number-of-users-in-specific-broadcast",e,t)},i.onNumberOfBroadcastViewersUpdated=function(e){i.enableLogs&&i.isInitiator&&console.info("Number of broadcast (",e.broadcastId,") viewers",e.numberOfBroadcastViewers)},i.onUserStatusChanged=function(e,t){!i.enableLogs||t||console.info(e.userid,e.status)},i.getUserMediaHandler=y,i.multiPeersHandler=k,i.enableLogs=!0,i.setCustomSocketHandler=function(e){"undefined"!=typeof n&&(n=e)},i.chunkSize=40000,i.maxParticipantsAllowed=1e3,i.disconnectWith=k.disconnectWith,i.checkPresence=function(e,t){return e=e||i.sessionid,"SSEConnection"===n.name?void SSEConnection.checkPresence(e,function(e,n,s){return i.socket?void t(e,n):(e||(i.userid=n),void i.connectSocket(function(){t(e,n,s)}))}):i.socket?void i.socket.emit("check-presence",e+"",function(e,n,s){i.enableLogs&&console.log("checkPresence.isRoomExist: ",e," roomid: ",n),t(e,n,s)}):void i.connectSocket(function(){i.checkPresence(e,t)})},i.onReadyForOffer=function(e,t){i.multiPeersHandler.createNewPeer(e,t)},i.setUserPreferences=function(e){return i.dontAttachStream&&(e.dontAttachLocalStream=!0),i.dontGetRemoteStream&&(e.dontGetRemoteStream=!0),e},i.updateExtraData=function(){i.socket.emit("extra-data-updated",i.extra)},i.enableScalableBroadcast=!1,i.maxRelayLimitPerUser=3,i.dontCaptureUserMedia=!1,i.dontAttachStream=!1,i.dontGetRemoteStream=!1,i.onReConnecting=function(e){i.enableLogs&&console.info("ReConnecting with",e.userid,"...")},i.beforeAddingStream=function(e){return e},i.beforeRemovingStream=function(e){return e},"undefined"!=typeof isChromeExtensionAvailable&&(i.checkIfChromeExtensionAvailable=isChromeExtensionAvailable),"undefined"!=typeof isFirefoxExtensionAvailable&&(i.checkIfChromeExtensionAvailable=isFirefoxExtensionAvailable),"undefined"!=typeof getChromeExtensionStatus&&(i.getChromeExtensionStatus=getChromeExtensionStatus),i.modifyScreenConstraints=function(e){return e},i.onPeerStateChanged=function(e){i.enableLogs&&-1!==e.iceConnectionState.search(/closed|failed/gi)&&console.error("Peer connection is closed between you & ",e.userid,e.extra,"state:",e.iceConnectionState)},i.isOnline=!0,c("online",function(){i.isOnline=!0}),c("offline",function(){i.isOnline=!1}),i.isLowBandwidth=!1,navigator&&navigator.connection&&navigator.connection.type&&(i.isLowBandwidth=-1!==navigator.connection.type.toString().toLowerCase().search(/wifi|cell/g),i.isLowBandwidth)){if(i.bandwidth={audio:!1,video:!1,screen:!1},i.mediaConstraints.audio&&i.mediaConstraints.audio.optional&&i.mediaConstraints.audio.optional.length){var R=[];i.mediaConstraints.audio.optional.forEach(function(e){"undefined"==typeof e.bandwidth&&R.push(e)}),i.mediaConstraints.audio.optional=R}if(i.mediaConstraints.video&&i.mediaConstraints.video.optional&&i.mediaConstraints.video.optional.length){var R=[];i.mediaConstraints.video.optional.forEach(function(e){"undefined"==typeof e.bandwidth&&R.push(e)}),i.mediaConstraints.video.optional=R}}i.getExtraData=function(e,t){if(!e)throw"remoteUserId is required.";return"function"==typeof t?void i.socket.emit("get-remote-user-extra-data",e,function(e,n,s){t(e,n,s)}):i.peers[e]?i.peers[e].extra:i.peersBackup[e]?i.peersBackup[e].extra:{}},!t.autoOpenOrJoin||i.openOrJoin(i.sessionid),i.onUserIdAlreadyTaken=function(e){i.close(),i.closeSocket(),i.isInitiator=!1,i.userid=i.token(),i.join(i.sessionid),i.enableLogs&&console.warn("Userid already taken.",e,"Your new userid:",i.userid)},i.trickleIce=!0,i.version="3.6.9",i.onSettingLocalDescription=function(e){i.enableLogs&&console.info("Set local description for remote user",e.userid)},i.resetScreen=function(){sourceId=null,DetectRTC&&DetectRTC.screen&&delete DetectRTC.screen.sourceId,currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[]}},i.autoCreateMediaElement=!0,i.password=null,i.setPassword=function(e,t){t=t||function(){},i.socket?i.socket.emit("set-password",e,t):(i.password=e,t(!0,i.sessionid,null))},i.onSocketDisconnect=function(){i.enableLogs&&console.warn("socket.io connection is closed")},i.onSocketError=function(){i.enableLogs&&console.warn("socket.io connection is failed")},i.errors={ROOM_NOT_AVAILABLE:"Room not available",INVALID_PASSWORD:"Invalid password",USERID_NOT_AVAILABLE:"User ID does not exist",ROOM_PERMISSION_DENIED:"Room permission denied",ROOM_FULL:"Room full",DID_NOT_JOIN_ANY_ROOM:"Did not join any room yet",INVALID_SOCKET:"Invalid socket",PUBLIC_IDENTIFIER_MISSING:"publicRoomIdentifier is required",INVALID_ADMIN_CREDENTIAL:"Invalid username or password attempted"}})(this)};"undefined"!=typeof module&&(module.exports=exports=RTCMultiConnection),"function"==typeof define&&define.amd&&define("RTCMultiConnection",[],function(){return RTCMultiConnection});